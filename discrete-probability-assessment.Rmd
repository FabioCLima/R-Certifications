---
title: "Discrete Probability Assessment"
author: "Fabio Carvalho Lima"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3) # report 3 significant digits
```

## Assessment: Discrete Probability
### Question 1: Olympic running


Libraries that will be used for the calculations in this assessment. This assessment has 3 sections, all related to *Discrete Probability*.

```{r Libraries, message=FALSE, warning=FALSE}

library(gtools)
library(tidyverse)

```
  In the 200m dash finals in the Olympics, 8 runners compete for 3 medals 
(order matters). In the 2012 Olympics, 3 of the 8 runners were from Jamaica 
and the other 5 were from different countries. The three medals were all won 
by Jamaica (Usain Bolt, Yohan Blake, and Warren Weir).

Use the information above to help you answer the following four questions.

**Question 1a** - How many different ways can the 3 medals be distributed across 8 runners?

**Solution 1a :**
To answer this question we need to remember in this kind of competion the orders matters, for the first runner, he will get gold medal, and so on, it seems we 
have to use permutations function to answer this question.

```{r Answer 1a }

all_medals <- nrow(permutations(8,3)) # if orders matters, we must use permutations
                                      # nrow will give us the number of the observations
all_medals
```

---

**Question 1b** - How many different ways can the three medals be distributed among the 3 runners from Jamaica?

**Solution 1b :**
To answer this question we can use the same approach for previous question, the only diference, we have to make the permutations between the runners from Jamaica only.

```{r Answer 1b }

nrow(permutations(3,3)) # all the permutations between 3 runners from the same country

```

---

**Question 1c** - What is the probability that all 3 medals are won by Jamaica?


**Solution 1c:** 


S = all different ways the 3 medals distributed between 8 runners *(answer question 1a)


$n_{runners from Jamaica}$ = all ways the Jamaica runners can win


$Pr(runners from Jamaica)$ = **probability that all 3 medals are won by Jamaica**

```{r Answer 1c }
runners_Jamaica <- nrow(permutations(3,3)) # Jamaica cases
all_8_runners <- nrow(permutations(8,3))   # all cases

Pr_runners_Jamaica <- runners_Jamaica / all_8_runners
Pr_runners_Jamaica  # our answer

```
---

**Question 1d** - Run a Monte Carlo simulation on this vector representing of the 8 runners in this race:

```{r question 1d vector of runners}
runners <- c("Jamaica", "Jamaica", "Jamaica", "USA", "Ecuador", "Netherlands",
             "France", "South Africa")
```
Calculate the probability that all the runners are from Jamaica.


**Solution 1d :**

In order to create a Monte Carlo Simulation, we need to 3 steps:

1.Trials:


We need to create a trial which it will represent the sample from the runners vectors, then take 3 samples at time.

```{r trials}
runners_medals <- sample(runners, size = 3)
```
2.Success


Here we must get all winners from Jamaica.

```{r success}
all(runners_medals == "Jamaica")
```
3. Monte Carlo Simulation


Using the definitions we create on step 1 and step 2, here we code the simulation
```{r Monte Carlo Simulation}
set.seed(1)
B <- 10^3 # number of simulations 
medals <- replicate(B, {
  runners_medals <- sample(runners, size = 3)
  all(runners_medals %in% "Jamaica")
})
(Pr_runners_Jamaica <- mean(medals)) # show all the probabilities for the Jamaica runners
```



---

# Question 2: Restaurante Management

A restaurant manager wants to advertise that his lunch special offers enough
choices to eat different meals every day of the year. He doesn't think his
current special actually allows that number of choices, but wants to change
his special if needed to allow at least 365 choices.

A meal at the restaurant includes 1 entree, 2 sides, and 1 drink. He
currently offers a choice of 1 entree from a list of 6 options, a choice of
2 different sides from a list of 6 options, and a choice of 1 drink from a
list of 2 options.

* Question2a:
How many meal combinations are possible with the current menu ?

**Solution:** 
All we need to do here is use counting: 1 have only one 1 entree from a list of 6 options: nrow(permutations(6,1))
```{r entree}
entree <- 6
```
For the sides we can write: nrow(combinations(6,2))
```{r sides}

nrow(combinations(6,2))
```
For the drink options we will have:
```{r drinks}

drink <- 2
```
To calculate all possible combinations for the menu we can  multiply the combinations above:

```{r new menu}

(all_menu_combinations <- entree  * nrow(combinations(6,2)) *
   drink)
```

* Question 2b:
The manager has one additional drink he could add to the special.


How many combinations are possible if he expands his original special to 3 drink options ?

**Solution:**
For this question we just to update the combinations for drink, instead use **nrow(permutations(2,1)) --> nrow(permutations(3,1))**

```{r new menu2}

(all_new_menu_combinations <- nrow(permutations(6,1))*nrow(combinations(6,2))*
  nrow(permutations(3,1)))
```

* Question 2c:

The manager decides to add the third drink but needs to expand the number of options. The manager would prefer not to change his menu further and wants to know if he can meet his goal by letting customers choose more sides.

How many meal combinations are there if customers can choose from 6 entrees, 3 drinks, and select 3 sides from the current 6 options?

**Solution 2c:**
we need to update our combinations into this new one:
for 6 entrees and 6 options:

```{r}

(n_entrees <- 6)
```
3 sides from the current 6 options:

```{r}

(n_sides <- nrow(combinations(6,3)))
```
3 drinks from a list of 2 options

```{r}
(n_drinks <- 3)
```
new menu n_entrees*n_sides*n_drinks

```{r}

(new_menu <- n_entrees*n_sides*n_drinks)
```
* Question 2d:

The manager is concerned that customers may not want 3 sides with their meal.


He is willing to increase the number of entree choices instead, but if he addstoo many expensive options it could eat into profits. He wants to know how many entree choices he would have to offer in order to meet his goal.


Use sapply to apply the function to entree option counts ranging from 1 to 12.
What is the minimum number of entree options required in order to generate more
than 365 combinations?

```{r}

entree_choices <- c(1:12)
```
```{r function menu}

menu <- function(entree_choices){
  # for n entrees and 6 options: n = entree_choices
  entrees <- entree_choices
  n_sides <- nrow(combinations(6,2)) # sides combinations
  n_drinks <- 3
  new_menu <- entrees*n_sides*n_drinks # menu combinations
}

new_menu <- sapply(entree_choices, menu)
data.frame(entree_choices = 1:12, new_menu = new_menu) %>%
  filter(new_menu > 365) %>%
  min(.$entree_choice)
```

The manager isn't sure he can afford to put that many entree choices on the lunch menu and thinks it would be cheaper for him to expand the number of sides. He wants to know how many sides he would have to offer to meet his goal of at least 365 combinations.



Write a function that takes a number of side choices and returns the number  of meal combinations possible given 6 entree choices, 3 drink choices, and a selection of 2 sides from the specified number of side choices.

```{r }

side_choices <- function(x){
  6 * nrow(combinations(x, 2)) * 3
}

combos <- sapply(2:12, side_choices)

data.frame(sides = 2:12, combos = combos) %>%
  filter(combos > 365) %>%
  min(.$sides)
```

---
## Questions 3 and 4: Esophageal cancer and alcohol/tobacco use, part1


Case-control studies help determine whether certain exposures are associated with outcomes such as developing cancer. The built-in dataset **esoph** contains data from a case-control study in France comparing people with esophageal cancer (cases, counted in **ncases**) to people without esophageal cancer (controls, counted in **ncontrols**) that are carefully matched on a variety of demographic and medical characteristics. The study compares alcohol intake in grams per day (**alcgp**) and tobacco intake in grams per day (**tobgp**) across cases and controls grouped by age range (**agegp**).


The dataset is available in base R and can be called with the variable name **esoph**:
```{r dataset}

head(esoph)
```

You will be using this dataset to answer the following four multi-part questions (Questions 3-6).


You may wish to use the **tydverse** package:
```{r}
library(tidyverse)
```


---

The following three parts have you explore some basic characteristics of the dataset.


Each row contains a combination of age group, alcool consumption group, and tobacco consumption group, followed by the number of cancer cases and number of controls for study subjects in that combined grouping.

---

* Question3a:
How many groups are in the study?

**Solution3a:**
You can find the number of groups using
```{r 3a}

nrow(esoph)
```

* Question3b:
How many cases are there?*(tip: Save this value as all_cases for later problems)*
**Solution3b:**
```{r 3b}
all_cases <- sum(esoph$ncases)
all_cases
```

* Question3c:
How many controls are there?*(tip: Save this value as all_controls for later problems)*
**Solution3c:**
```{r 3c}

all_controls <- sum(esoph$ncontrols)
all_controls
```
---

The following four parts ask you to explore some probabilities within this dataset related to alcohol and tobacco consumption.


---


* Question4a:

What is the probability that a subject in the highest alcohol consuption group is a cancer case?


**Solution4a:**
You can find the probability using this code:
```{r 4a}

esoph %>%
  filter(alcgp == "120+") %>%
  summarize(ncases = sum(ncases), ncontrols = sum(ncontrols)) %>%
  mutate(p_case = ncases / (ncases + ncontrols)) %>%
  pull(p_case)
```

* Question4b:*

What is the probability that subject in the lowest consumption group is a cancer case?


**Solution4b:**
You can find the probability using this code:
```{r 4b}

esoph %>%
  filter(alcgp == "0-39g/day") %>%
  summarize(ncases = sum(ncases), ncontrols = sum(ncontrols)) %>%
  mutate(p_case = ncases / (ncases + ncontrols)) %>%
  pull(p_case)
```


* Question4c:

Given that a person is a case, what is the probability that they smoke 10g or more a day?


**Solution4c:**
You can find the probability using this code:
```{r 4c}

tob_cases <- esoph %>%
  filter(tobgp != "0-9g/day") %>%
  pull(ncases) %>%
  sum()

tob_cases/all_cases
```


* Question4d*:

Given that a person is a control, what is the probability that they smoke 10g or more a day?


**Solution4d:**
You can find the probability using this code:
```{r 4d}

tob_controls <- esoph %>%
  filter(tobgp != "0-9g/day") %>%
  pull(ncontrols) %>%
  sum()

tob_controls/all_controls
```
---


#Questions 5 and 6: Esophageal cancer and alcohol/tobacco use, part 2


The following four parts look at probabilities related to alcohol and tobacco consumption among the cases.


---

* Question 5a

For cases, what is the probability of being in the highest alcohol group?


**Solution5a:**
The probability can be calculated using the following code:
```{r 5a}

high_alc_cases <- esoph %>%
  filter(alcgp == "120+") %>%
  pull(ncases) %>%
  sum()

p_case_high_alc <- high_alc_cases/all_cases
p_case_high_alc
```

* Question 5b

For cases, what is the probability of being in the highest tobacco group?


**Solution5b:**
The probability can be calculated using the following code:
```{r 5b}

high_tob_cases <- esoph %>%
  filter(tobgp == "30+") %>%
  pull(ncases) %>%
  sum()

p_case_high_tob <- high_tob_cases/all_cases
p_case_high_tob
```

* Question5c:

For cases, what is the probability of being in the highest alcohol group **and** the highest tobacco group?


**Solution5c:**
The probability can be calculated using the following code:
```{r 5c}

high_alc_tob_cases <- esoph %>%
  filter(alcgp == "120+" & tobgp == "30+") %>%
  pull(ncases) %>%
  sum()

p_case_high_alc_tob <- high_alc_tob_cases/all_cases
p_case_high_alc_tob
```


* Question5d:

For cases, what is the probability of being in the highest alcohol group **or** the highest tobacco group?


**Solution5d:**
The probability can be calculated using the following code:
```{r 5d}
p_case_either_highest <- p_case_high_alc + p_case_high_tob - p_case_high_alc_tob
p_case_either_highest
```

---


The following six parts look at probabilities related to alcohol and tobacco consumption among the controls and also compare the cases and the controls.


---


* Question6a:

For controls, what is the probability of being in the highest alcohol group?


**Solution6a:**
The probability can be calculated using the following code:
```{r 6a}

high_alc_controls <- esoph %>%
  filter(alcgp == "120+") %>%
  pull(ncontrols) %>%
  sum()

p_control_high_alc <- high_alc_controls/all_controls
p_control_high_alc
```

* Question 6b:

How many time more likely are cases than controls to be in the highest alcohol group?


**Solution6b:**
The probability can be calculated using the following code:
```{r 6b}

p_case_high_alc/p_control_high_alc
```

* Question6c:

For controls, what is the probability of being in the highest tobacco group?

**Solution6c:**
The probability can be calculated using the following code:
```{r 6c}

high_tob_controls <- esoph %>%
  filter(tobgp == "30+") %>%
  pull(ncontrols) %>%
  sum()

p_control_high_tob <- high_tob_controls/all_controls
p_control_high_tob
```

* Question6d:

For controls, what is the probability of being in the highest alcool group **and** the highest tobacco group?

**Solution6d:**
The probability can be calculated using the following code:
```{r 6d}

high_alc_tob_controls <- esoph %>%
  filter(alcgp == "120+" & tobgp == "30+") %>%
  pull(ncontrols) %>%
  sum()

p_control_high_alc_tob <- high_alc_tob_controls/all_controls
p_control_high_alc_tob
```


* Question6e:

For controls, what is the probability of being in the highest alcohol group **or** the highest tobacco group?


**Solution6e:**
The probability can be calculated using the following code:
```{r 6e}

p_control_either_highest <- p_control_high_alc + p_control_high_tob - p_control_high_alc_tob
p_control_either_highest
```


* Question6f:

How many times more likely are cases than controls to be in the highest alcohol group **or** the highest tobacco group?


**Solution6f:**
This calculated using the following code:
```{r 6f}

p_case_either_highest/p_control_either_highest
```


